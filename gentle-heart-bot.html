<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Gentle Heart</title>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#06442a">

<style>
:root{
  --emerald-900:#04331f;
  --emerald-800:#06442a;
  --emerald-700:#0b5b39;
  --emerald-600:#0e6e47;
  --emerald-500:#1aa667;
  --bot:#d7f3e6;
  --user:#ffffff;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--emerald-900);}

.app{
  height:100%;
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  position:fixed;
  top:0; left:0; right:0;
  height:60px;
  background:var(--emerald-800);
  display:flex;
  align-items:center;
  padding:0 12px;
  z-index:10;
}
header img{width:36px;height:36px;border-radius:50%;}
header .spacer{flex:1}
header button{
  background:none;border:none;color:white;font-size:20px;
}

/* CHAT */
.chat{
  flex:1;
  margin-top:60px;
  margin-bottom:70px;
  overflow-y:auto;
  padding:12px;
}
.msg{
  display:flex;
  margin-bottom:12px;
  align-items:flex-end;
}
.msg.bot{flex-direction:row;}
.msg.user{flex-direction:row-reverse;}
.msg img{
  width:32px;height:32px;border-radius:50%;
  margin:0 6px;
}
.bubble{
  max-width:75%;
  padding:10px 14px;
  border-radius:14px;
  line-height:1.4;
  font-size:14px;
}
.bot .bubble{background:var(--bot);color:#04331f;}
.user .bubble{background:var(--user);color:#111;}

/* INPUT */
footer{
  position:fixed;
  bottom:0; left:0; right:0;
  background:var(--emerald-800);
  padding:10px;
}
footer input{
  width:100%;
  padding:12px;
  border-radius:20px;
  border:none;
  font-size:14px;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal .box{
  background:#fff;
  width:90%;
  max-width:320px;
  border-radius:14px;
  padding:16px;
}
.modal button{
  width:100%;
  padding:10px;
  margin-top:8px;
}
</style>
</head>

<body>
<div class="app">

<header>
  <img src="avatar.png">
  <div class="spacer"></div>
  <input type="file" id="avatarUpload" hidden>
  <button onclick="avatarUpload.click()">üë§</button>
  <button onclick="openSettings()">‚öôÔ∏è</button>
</header>

<div class="chat" id="chat"></div>

<footer>
  <input id="input" placeholder="Type your message‚Ä¶" />
</footer>

</div>

<!-- SETTINGS -->
<div class="modal" id="settings">
  <div class="box">
    <button onclick="clearChat()">Clear history</button>
    <button onclick="kidsMode=!kidsMode">Kids mode</button>
    <button onclick="privateMode=!privateMode">Private mode</button>
    <button onclick="country='PH'">PH</button>
    <button onclick="country='INTERNATIONAL'">International</button>
    <button onclick="closeSettings()">Close</button>
  </div>
</div>

<script>
let qa=null;
let currentState=null;
let kidsMode=false;
let privateMode=false;
let country="PH";
const chat=document.getElementById('chat');
const input=document.getElementById('input');
let userAvatar=null;

fetch('./qa.json').then(r=>r.json()).then(j=>{
  qa=j;
  currentState=j.start;
  botReply(j.states[currentState].text.en);
});

function botReply(text){
  const typing=document.createElement('div');
  typing.className='msg bot';
  typing.innerHTML=`<img src="avatar.png"><div class="bubble">typing‚Ä¶</div>`;
  chat.appendChild(typing);
  chat.scrollTop=chat.scrollHeight;

  setTimeout(()=>{
    typing.remove();
    addMsg('bot',text);
  },2000);
}

function addMsg(who,text){
  const div=document.createElement('div');
  div.className='msg '+who;
  div.innerHTML=`
    <img src="${who==='bot'?'avatar.png':(userAvatar||'avatar.png')}">
    <div class="bubble">${text}</div>`;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

input.addEventListener('keydown',e=>{
  if(e.key==='Enter' && input.value.trim()){
    const msg=input.value.trim().toLowerCase();
    input.value='';
    addMsg('user',msg);
    route(msg);
  }
});

function route(msg){
  for(const id in qa.states){
    const st=qa.states[id];
    if(st.keywords.some(k=>msg.includes(k))){
      currentState=id;
      botReply(st.text.en);
      return;
    }
  }
  botReply("I‚Äôm here with you, do you want to talk more about how you feel or try another topic gently?");
}

function openSettings(){settings.style.display='flex'}
function closeSettings(){settings.style.display='none'}
function clearChat(){chat.innerHTML='';}
avatarUpload.onchange=e=>{
  const f=e.target.files[0];
  if(f) userAvatar=URL.createObjectURL(f);
};
</script>
</body>
</html>
