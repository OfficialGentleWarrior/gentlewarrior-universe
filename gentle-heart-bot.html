<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Gentle Heart</title>

<style>
:root{
  --emerald:#04331f;
  --emerald2:#06442a;
  --light:#f6fbf8;
}

html,body{
  margin:0;
  height:100%;
}

body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:var(--emerald);
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  background:var(--emerald2);
  color:#fff;
  padding:10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.header-left,.header-right{
  display:flex;
  align-items:center;
  gap:10px;
}

header img{
  width:36px;
  height:36px;
  border-radius:50%;
  background:#fff;
}

.header-title{
  text-align:center;
  flex:1;
}

/* CHAT */
#chat{
  flex:1;
  background:var(--light);
  padding:12px;
  overflow-y:auto;
  border-radius:16px 16px 0 0;
}

.msg{
  max-width:80%;
  padding:10px 12px;
  margin:8px 0;
  border-radius:14px;
  line-height:1.4;
}

.bot{ background:#e3f2eb; }
.user{
  background:var(--emerald2);
  color:#fff;
  margin-left:auto;
}

/* INPUT */
#inputWrap{
  position:sticky;
  bottom:0;
  background:var(--light);
  padding:10px env(safe-area-inset-right) calc(10px + env(safe-area-inset-bottom)) env(safe-area-inset-left);
  display:flex;
  gap:8px;
  border-top:1px solid #ddd;
}

input{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
}

button{
  padding:10px 16px;
  border-radius:10px;
  border:none;
  background:var(--emerald2);
  color:#fff;
}
</style>
</head>

<body>

<header>
  <div class="header-left">
    <img src="avatar.png">
  </div>
  <div class="header-title">
    <strong>Gentle Heart</strong><br>
    <small>Your gentle companion</small>
  </div>
  <div class="header-right">
    <img id="userAvatar">
    ⚙️
  </div>
</header>

<div id="chat"></div>

<div id="inputWrap">
  <input id="userInput" placeholder="Type here…">
  <button id="sendBtn" disabled>Send</button>
</div>

<script>
let QA=null,currentStateId=null,currentLang='en';
const chat=document.getElementById('chat');
const input=document.getElementById('userInput');
const sendBtn=document.getElementById('sendBtn');

/* LOAD QA */
(async()=>{
  const res=await fetch('./qa.json');
  QA=await res.json();
  currentStateId=QA.start;
  sendBtn.disabled=false;
})();

/* UTIL */
const normalize=t=>t.toLowerCase().trim();
function isTagalog(t){
  return /(kumusta|hindi|mabigat|gutom|ok|okay|pakiramdam|salamat)/i.test(t);
}
function addMsg(text,cls){
  const d=document.createElement('div');
  d.className='msg '+cls;
  d.textContent=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

/* ROUTER */
function resolve(text){
  const t=normalize(text);
  for(const [id,s] of Object.entries(QA.states)){
    if(!s.keywords)continue;
    if(s.keywords.some(k=>t.includes(k))){
      if(id!==currentStateId){
        currentStateId=id;
        return QA.states[id];
      }
    }
  }
  return null;
}

/* SEND */
sendBtn.onclick=()=>{
  if(!QA)return;
  const t=input.value.trim();
  if(!t)return;

  currentLang=isTagalog(t)?'tl':'en';
  addMsg(t,'user');
  input.value='';

  const next=resolve(t);
  if(next){
    addMsg(next.text[currentLang],'bot');
  }
};
</script>

</body>
</html>
