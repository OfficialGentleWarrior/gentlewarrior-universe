<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Warrior — Gentle Warrior</title>
  <meta name="description" content="Flappy Warrior — a gentle memory-friendly mini-game. Play, beat scores, share.">
  <style>
    :root{
      --bg:#072517;
      --panel:#0f2a20;
      --accent:#9ae07a;
      --muted:#cfead3;
      --glass: rgba(255,255,255,0.04);
      --radius:12px;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg,#04221a 0%, #071b16 100%);
      color:var(--muted);
      padding:20px;
    }
    .card{
      width:100%;
      max-width:820px;
      border-radius:16px;
      background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.3));
      box-shadow:0 8px 30px rgba(0,0,0,0.6);
      padding:18px;
      box-sizing:border-box;
    }
    header {display:flex;gap:12px;align-items:center;margin-bottom:12px;}
    header img{width:72px;height:72px;border-radius:12px;object-fit:cover;}
    header h1{font-size:20px;margin:0}
    .row{display:flex;gap:12px;align-items:center}
    #game-area{display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start;}
    #gamebox{background:var(--panel);border-radius:12px;padding:12px;box-sizing:border-box;flex:1;min-width:300px;}
    canvas{display:block;border-radius:8px;background:#000}
    .controls{display:flex;gap:8px;align-items:center;margin-top:10px}
    button{
      background:var(--accent);color:#042018;border:0;padding:10px 14px;border-radius:10px;font-weight:700;
      box-shadow:0 6px 14px rgba(0,0,0,0.35);cursor:pointer;
    }
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
    .score{margin-left:auto;padding:8px 12px;background:var(--glass);border-radius:10px;font-weight:700;color:var(--muted)}
    .meta{margin-top:12px;color:rgba(255,255,255,0.7);font-size:13px}
    .share-row{display:flex;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .small{font-size:13px;color:rgba(255,255,255,0.75)}
    footer{margin-top:10px;color:rgba(255,255,255,0.5);font-size:13px;text-align:center}
    .overlay{position:absolute;left:50%;transform:translateX(-50%);text-align:center;color:white}
    .center{display:flex;align-items:center;justify-content:center}
    @media (max-width:640px){ .card{padding:14px} header img{width:56px;height:56px} }
  </style>
</head>
<body>
  <div class="card" role="main">
    <header>
      <img src="flap-mid.png" alt="Gentle Warrior" />
      <div>
        <h1>Flappy Warrior</h1>
        <div class="small">Tap/Click to flap — beat the score, share your run.</div>
      </div>
    </header>

    <div id="game-area">
      <div id="gamebox">
        <!-- Canvas container -->
        <div style="position:relative;">
          <canvas id="gameCanvas" width="480" height="640"></canvas>

          <!-- overlays -->
          <div id="startOverlay" class="overlay" style="top:45%">
            <img src="tap-start.png" alt="Tap to start" style="width:220px;max-width:65%;" />
          </div>

          <div id="gameOverOverlay" class="overlay" style="top:30%;display:none">
            <img src="game-over.png" alt="Game over" style="width:260px;max-width:75%" />
            <div style="margin-top:12px;">
              <button id="tryAgainBtn">Try again</button>
            </div>
          </div>
        </div>

        <div class="controls">
          <button id="startBtn">Start</button>
          <button class="secondary" id="resetBtn">Reset</button>
          <div class="score" id="scoreDisplay">Score: 0</div>
        </div>

        <div class="share-row">
          <button id="shareBtn">Share score</button>
          <div class="small">Tip: If your device supports sharing, use the native share dialog.</div>
        </div>

        <div class="meta">
          <strong>How to play:</strong> Tap or press space to flap. Avoid the pipes and beat your best score.
        </div>
      </div>

      <aside style="width:300px;min-width:220px;">
        <div style="background:var(--glass);padding:12px;border-radius:12px;">
          <h3 style="margin-top:0">Your best</h3>
          <div id="bestDisplay" style="font-size:28px;font-weight:800">0</div>
          <div style="margin-top:10px" class="small">When finished, share your run with the community.</div>
          <div style="margin-top:12px">
            <img src="flappy-share.png" alt="Share example" style="width:100%;border-radius:8px;display:block" />
          </div>
        </div>
        <div style="height:12px"></div>
        <div style="background:var(--glass);padding:12px;border-radius:12px;font-size:13px;color:rgba(255,255,255,0.85)">
          <strong>Notes:</strong>
          <ul style="padding-left:18px;margin:8px 0 0 0">
            <li>All images should be in the same folder as this file.</li>
            <li>Use filenames exactly: <code>flap-up.png</code>, <code>flap-mid.png</code>, <code>flap-down.png</code>, <code>background.png</code>, <code>pipe.png</code>, <code>ground.png</code>, <code>tap-start.png</code>, <code>game-over.png</code>, <code>flappy-share.png</code>.</li>
          </ul>
        </div>
      </aside>
    </div>

    <footer>© 2025 Gentle Warrior — gentlewarrior-universe.netlify.app</footer>
  </div>

<script>
/* -------------------------
   FLAPPY WARRIOR - single-file game
   Files needed (same folder):
   flap-up.png, flap-mid.png, flap-down.png,
   background.png, pipe.png, ground.png,
   tap-start.png, game-over.png, flappy-share.png
   ------------------------- */

(function(){
  const ASSET_PATH = ""; // "" or "images/" if you placed pictures inside images/
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d', { alpha: false });
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const scoreDisplay = document.getElementById('scoreDisplay');
  const bestDisplay = document.getElementById('bestDisplay');
  const shareBtn = document.getElementById('shareBtn');
  const startOverlay = document.getElementById('startOverlay');
  const gameOverOverlay = document.getElementById('gameOverOverlay');
  const tryAgainBtn = document.getElementById('tryAgainBtn');

  // Game constants
  const WIDTH = canvas.width;
  const HEIGHT = canvas.height;
  const GRAV = 0.5;
  const FLAP_STRENGTH = -8;
  const PIPE_GAP = 160;
  const PIPE_SPEED = 2.2;
  const PIPE_INTERVAL = 1500; // ms

  // Images
  const images = {};
  const imageFiles = {
    flapUp: ASSET_PATH + 'flap-up.png',
    flapMid: ASSET_PATH + 'flap-mid.png',
    flapDown: ASSET_PATH + 'flap-down.png',
    bg: ASSET_PATH + 'background.png',
    pipe: ASSET_PATH + 'pipe.png',
    ground: ASSET_PATH + 'ground.png',
    tapStart: ASSET_PATH + 'tap-start.png',
    gameOver: ASSET_PATH + 'game-over.png',
    shareCard: ASSET_PATH + 'flappy-share.png'
  };

  // Load images
  let toLoad = Object.keys(imageFiles).length;
  function loadAll(cb){
    Object.entries(imageFiles).forEach(([key, src])=>{
      const img = new Image();
      img.src = src;
      img.onload = ()=> {
        images[key] = img;
        toLoad--;
        if(toLoad===0) cb();
      };
      img.onerror = ()=> {
        // still call cb even if missing — dev should ensure files exist
        console.warn('Image failed:', src);
        images[key] = null;
        toLoad--;
        if(toLoad===0) cb();
      };
    });
  }

  // Game state
  let running=false, started=false, gameOver=false;
  let lastPipeTime=0;
  let pipes=[];
  let score=0, best=0;
  let spriteFrame=0, spriteTimer=0;
  let player = { x: 120, y: HEIGHT/2, vy:0, w:64, h:64 };

  // Load best from localStorage
  try{ best = Number(localStorage.getItem('flappy_best')||0); }catch(e){ best=0; }
  bestDisplay.textContent = best;

  // Input
  function flap(){
    if(!started){
      startGame();
      return;
    }
    if(gameOver){
      return;
    }
    player.vy = FLAP_STRENGTH;
    // quick frame bump to up
    spriteFrame = 0;
    spriteTimer = 0;
  }
  window.addEventListener('keydown', (e)=> { if(e.code==='Space') { e.preventDefault(); flap(); }});
  canvas.addEventListener('click', flap);
  canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); flap(); }, {passive:false});
  startBtn.addEventListener('click', ()=> {
    startGame();
  });
  tryAgainBtn.addEventListener('click', ()=> {
    resetGame();
    startGame();
  });
  resetBtn.addEventListener('click', ()=> {
    resetGame();
  });

  // Share function
  shareBtn.addEventListener('click', async ()=>{
    const shareText = `I scored ${score} in Flappy Warrior — can you beat it? https://${location.hostname}${location.pathname}#flappy`;
    // Try native share first
    if(navigator.share){
      try{
        await navigator.share({
          title: 'Flappy Warrior',
          text: shareText,
          url: location.href
        });
        return;
      }catch(err){
        console.log('Share canceled or failed', err);
      }
    }
    // Fallback: open X/Twitter intent with text
    const tweet = encodeURIComponent(shareText);
    const url = `https://x.com/intent/tweet?text=${tweet}`;
    window.open(url, '_blank');
  });

  // Game functions
  function startGame(){
    if(!started){
      started = true;
      running = true;
      startOverlay.style.display = 'none';
      gameOverOverlay.style.display = 'none';
      lastPipeTime = performance.now();
      pipes = [];
      score = 0;
      player.y = HEIGHT/2;
      player.vy = 0;
      loop(performance.now());
    }
  }

  function resetGame(){
    started = false;
    running = false;
    gameOver = false;
    pipes = [];
    score = 0;
    player.y = HEIGHT/2;
    player.vy = 0;
    startOverlay.style.display = '';
    gameOverOverlay.style.display = 'none';
    scoreDisplay.textContent = 'Score: 0';
  }

  function spawnPipe(){
    const min = 80;
    const max = HEIGHT - 160 - min;
    const topH = Math.floor(min + Math.random()*(max-min));
    const gap = PIPE_GAP;
    pipes.push({ x: WIDTH + 40, top: topH, bottom: topH + gap });
  }

  function update(dt){
    if(!running) return;

    // player physics
    player.vy += GRAV;
    player.y += player.vy;
    // screen bounds
    if(player.y + player.h/2 >= HEIGHT - 48){ // hits ground
      player.y = HEIGHT - 48 - player.h/2;
      endGame();
      return;
    }
    if(player.y - player.h/2 <= 0){
      player.y = player.h/2;
      player.vy = 0;
    }

    // pipes movement
    for(let i=pipes.length-1;i>=0;i--){
      pipes[i].x -= PIPE_SPEED;
      // scoring: when pipe passes player center
      if(!pipes[i].scored && pipes[i].x + 50 < player.x){
        pipes[i].scored = true;
        score++;
        scoreDisplay.textContent = 'Score: ' + score;
        if(score > best){
          best = score;
          bestDisplay.textContent = best;
          try{ localStorage.setItem('flappy_best', best); }catch(e){}
        }
      }
      // remove off-screen
      if(pipes[i].x < -120) pipes.splice(i,1);
    }

    // spawn pipes periodically
    const now = performance.now();
    if(now - lastPipeTime > PIPE_INTERVAL){
      lastPipeTime = now;
      spawnPipe();
    }

    // check collisions with pipes
    for(const p of pipes){
      const pipeW = 90;
      const px = p.x, pyTop = 0, phTop = p.top;
      const pxBotY = p.bottom;
      // simple AABB: player box
      const pw = player.w * 0.6, ph = player.h * 0.6;
      const pxCenter = player.x - pw/2, pyCenter = player.y - ph/2;
      // top pipe rect and bottom pipe rect
      if(rectIntersect(pxCenter, pyCenter, pw, ph, px, pyTop, pipeW, phTop) ||
         rectIntersect(pxCenter, pyCenter, pw, ph, px, pxBotY, pipeW, HEIGHT - pxBotY - 48)){
        endGame();
      }
    }

    // sprite frame selection based on vertical velocity
    spriteTimer += dt;
    // choose frame by vy:
    if(player.vy < -3) spriteFrame = 0; // up
    else if(player.vy > 4) spriteFrame = 2; // down
    else spriteFrame = 1; // mid
  }

  function rectIntersect(ax,ay,aw,ah,bx,by,bw,bh){
    return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
  }

  function endGame(){
    running = false;
    started = false;
    gameOver = true;
    gameOverOverlay.style.display = '';
    // show final score
  }

  // draw
  function draw(){
    // clear
    ctx.clearRect(0,0,WIDTH,HEIGHT);

    // background
    if(images.bg) {
      // stretch bg to canvas
      ctx.drawImage(images.bg, 0, 0, WIDTH, HEIGHT);
    } else {
      ctx.fillStyle = '#05301e';
      ctx.fillRect(0,0,WIDTH,HEIGHT);
    }

    // pipes
    ctx.save();
    for(const p of pipes){
      // top pipe (flip vertically)
      if(images.pipe){
        ctx.drawImage(images.pipe, p.x, 0, 90, p.top);
        // bottom pipe using same image
        const bottomH = HEIGHT - p.bottom - 48;
        ctx.drawImage(images.pipe, p.x, p.bottom, 90, bottomH);
      } else {
        ctx.fillStyle = '#154b34';
        ctx.fillRect(p.x, 0, 90, p.top);
        ctx.fillRect(p.x, p.bottom, 90, HEIGHT - p.bottom - 48);
      }
    }
    ctx.restore();

    // ground
    if(images.ground){
      // tile ground across bottom
      const gH = 48;
      for(let x=0;x<WIDTH;x+=images.ground.width){
        ctx.drawImage(images.ground, x - ((performance.now()/8) % images.ground.width), HEIGHT - gH, images.ground.width, gH);
      }
    } else {
      ctx.fillStyle = '#062a1f';
      ctx.fillRect(0,HEIGHT-48,WIDTH,48);
    }

    // player sprite (centered)
    let spriteImg = images.flapMid;
    if(spriteFrame===0) spriteImg = images.flapUp;
    if(spriteFrame===1) spriteImg = images.flapMid;
    if(spriteFrame===2) spriteImg = images.flapDown;

    const drawW = 84, drawH = 84;
    const dx = player.x - drawW/2;
    const dy = player.y - drawH/2;
    if(spriteImg) ctx.drawImage(spriteImg, dx, dy, drawW, drawH);
    else {
      ctx.fillStyle = '#9ae07a';
      ctx.fillRect(dx,dy,drawW,drawH);
    }
  }

  // main loop
  let last = performance.now();
  function loop(now){
    const dt = Math.min(40, now - last);
    last = now;
    update(dt);
    draw();
    if(running) requestAnimationFrame(loop);
  }

  // initialization
  loadAll(()=> {
    // show start overlay image if available
    if(images.tapStart) {
      const img = startOverlay.querySelector('img');
      if(img) img.src = imageFiles.tapStart;
    }
    if(images.gameOver){
      const goimg = gameOverOverlay.querySelector('img');
      if(goimg) goimg.src = imageFiles.gameOver;
    }
    // set best display
    bestDisplay.textContent = best;
    // initial draw
    draw();
  });

  // update UI display (score)
  setInterval(()=>{ scoreDisplay.textContent = 'Score: ' + score; }, 200);

  // Expose a programmatic function to share direct link with score (used by social buttons)
  window.flappyShareLink = function(){
    const shareText = `I scored ${score} on Flappy Warrior — try it: ${location.href.replace(location.hash,'')}#flappy`;
    return shareText;
  };

})();
</script>
</body>
</html>